[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.6568098.svg)](https://doi.org/10.5281/zenodo.6568098)

This is a code repository to reproduce the following manuscript:

Scan-Centric, Frequency-Based Method for Characterizing Peaks from Direct Injection Fourier transform Mass Spectrometry Experiments

Robert M Flight, Joshua M Mitchell, Hunter N.B. Moseley

doi: https://doi.org/10.1101/2022.04.14.488423 (V1 on bioRxiv)

## Copies of Manuscript

Copies of manuscript & supplemental materials:

  * [html manuscript](https://moseleybioinformaticslab.github.io/manuscript.peakCharacterization/scancentricpeakcharacterization.html)
  * [html supplemental](https://moseleybioinformaticslab.github.io/manuscript.peakCharacterization/scancentricpeakcharacterization_supplemental.html)
  * [pdf manuscript](https://moseleybioinformaticslab.github.io/manuscript.peakCharacterization/scancentricpeakcharacterization.pdf)
  * [pdf supplemental](https://moseleybioinformaticslab.github.io/manuscript.peakCharacterization/scancentricpeakcharacterization_supplemental.pdf)


## ScanCentricPeakCharacterization Package

If you are looking for the scan-centric peak characterization R package, it is available here: https://github.com/MoseleyBioinformaticsLab/ScanCentricPeakCharacterization


## Get A Copy of the Repository

### From GitHub

```
git clone https://github.com/MoseleyBioinformaticsLab/manuscript.peakCharacterization.git

cd manuscript.peakCharacterization
```

### From Zenodo

[HTML Page](https://zenodo.org/record/6568098#.Yof1muPMKV4)

```
wget https://zenodo.org/record/6568098/files/manuscript.peakCharacterization-reproducible_v4.zip

unzip manuscript.peakCharacterization-reproducible_v4.zip
```


## Download the Various Data and the _targets Directory

We also need the data files and the _targets directory.

```
wget https://zenodo.org/record/6568053/files/scancentric_manuscript_targets.zip
unzip scancentric_manuscript_targets.zip

wget https://zenodo.org/record/6568016/files/scancentric_manuscript_data.zip
unzip scancentric_manuscript_data.zip
```

## Install the R Packages Within renv

Start R within the manuscript directory:

```r
# depending on how it starts up, you may
# need to install renv first
# theoretically it should "just work"
install.packages("renv")
renv::install("BiocManager@1.30.16")
renv::install("broom@0.7.11")
renv::install("tictoc@1.0.1")
renv::install("bioc::S4Vectors@0.32.3")
renv::install("bioc::limma@3.50.1")
renv::install("bioc::xcms@3.16.1")
renv::restore()
```

Restart R, just to be sure we start from a clean slate.

## Check What is Out of Date

```r
source("./packages.R")
target_status = tar_network(targets_only = TRUE)
target_status$vertices %>%
  dplyr::filter(!(status %in% "uptodate"))
```

When I do this, I see the manuscript, and some RSD pieces listed as out of date (7 items total).
All of the various analysis pieces seem to be mostly intact, which means that it should be trivial to update things, or go through and examine different pieces of the overall workflow.

## Files & Directories

* _targets.R: the overall workflow for the analysis.
* _targets/: keeping track of the state of things, and the actual outputs.
* R/: the various functions necessary for running the analysis
* doc/: the manuscript (in a couple of different styles), and supplemental materials.
* data/
  * data_input: the input data files
  * data_output: where various output files go, including the generated scan-centric peak characterization outputs, and their assignments.
    * lung_data: outputs related to the lung data
* lungcancer_all: scripts related to running all the NSCLC files on remote machines.
  * assignments: all of the assignment files from the NSCLC samples in JSON form.
* ftms_artifacts/peaklists: the peak lists from Xcalibur for all of the NSCLC samples in JSON form. 

## Notes on Re-Running Pieces

### Scan-Centric Characterizations

Each of the scan-centric-characterization bits takes at least 30 minutes, for the ones with more peaks (noperc especially), they will take even longer.
I personally ran them over the course of an afternoon across 5 different machines with shared network storage.

### SMIRFE Assignments

The SMIRFE code for generating assignments is not generally available, unfortunately.
For those who absolutely need it, please contact one of the authors about getting access to it.
The input zip files (and underlying JSON peak lists) are present, as well as the assignments generated by SMIRFE.


